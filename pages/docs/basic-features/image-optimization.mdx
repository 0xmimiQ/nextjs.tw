# 圖片元件與優化

<details open>
  <summary>
    <b>範例</b>
  </summary>
  <ul>
    <li>
      <a href="https://github.com/vercel/next.js/tree/canary/examples/image-component">
        <span>Image 元件</span>
      </a>
    </li>
  </ul>
</details>

Next.js 中的 Image 元件 [`next/image`](/docs/api-reference/next/image.md)，是為了因應現代網頁發展，自 HTML `<img>`元素延伸而成。它含有許多已內建好的效能優化機制，可協助開發者更易達到較高的 [網站體驗核心指標(Core Web Vitals)](https://nextjs.org/learn/seo/web-performance)，此指標分數為衡量網頁使用者體驗很重要的標準，並且也是影響 [Google 搜尋結果排行的關鍵因素](https://nextjs.org/learn/seo/web-performance/seo-impact)。

Image 元件內建的優化機制包含:

- **優化載入效能:** 依據不同載具，正確載入對應的圖片尺寸和現代圖片格式
- **增強視覺穩定:** 自動防止 [累計版面配置位移(Cumulative Layout Shift)](https://nextjs.org/learn/seo/web-performance/cls)
- **加快載入速度:** 圖片僅在進入可視範圍時才會載入，未載入完成時，可選擇使圖片先模糊顯示
- **提升取用彈性:** 即便是儲存於遠端伺服器的圖片，取用時也都會重新調整尺寸

## 使用 Image 元件

若要新增圖片至您的應用程式，請使用 [`next/image`](/docs/api-reference/next/image.md) 元件：

```jsx
import Image from 'next/image';
```

此外，當您需要使用較貼近原生 `<img>` 元素時，您也可使用 [`next/future/image`](/docs/api-reference/next/future/image.md)：

```jsx
import Image from 'next/future/image';
```

現在，您可以為您的圖片定義 `src` (無論本地或遠端)。

### 本機圖片

若要使用本機的圖片檔, 請匯入您的 `.jpg`, `.png`, 或 `.webp` 檔案：

```jsx
import profilePic from '../public/me.png';
```

這裡不支援動態載入 `await import()` 或 `require()`，僅支持靜態載入 `import`，如此一來，才可於建置時間分析載入的圖片檔。

Next.js 將自動依據載入檔案決定圖片的 `寬度(width)` 和 `高度(height)`，這樣才可在載入圖片時預防 [累計版面配置位移(Cumulative Layout Shift)](https://nextjs.org/learn/seo/web-performance/cls) 的問題。

```js
import Image from 'next/image';
import profilePic from '../public/me.png';

function Home() {
  return (
    <>
      <h1>My Homepage</h1>
      <Image
        src={profilePic}
        alt="Picture of the author"
        // width={500} Next.js自動提供
        // height={500} Next.js自動提供
        // blurDataURL="data:..." Next.js自動提供
        // placeholder="blur" // 可自行決定當圖片載入未完成時是否需模糊呈現
      />
      <p>Welcome to my homepage!</p>
    </>
  );
}
```

### 遠端圖片

需載入遠端圖片檔時，`src` 屬性需輸入 URL 字串，其可為 [相對](#loaders) 或 [絕對](/docs/api-reference/next/image.md#domains) 路徑。 因 Next.js 於建置過程中無法分析遠端圖片檔, 故您需手動提供 [`寬度(width)`](/docs/api-reference/next/image.md#width) 、 [`高度(height)`](/docs/api-reference/next/image.md#height) 與可自選提供的 [`blurDataURL`](/docs/api-reference/next/image.md#blurdataurl) 等 prop 參數 :

```jsx
import Image from 'next/image';

export default function Home() {
  return (
    <>
      <h1>My Homepage</h1>
      <Image
        src="/me.png"
        alt="Picture of the author"
        width={500}
        height={500}
      />
      <p>Welcome to my homepage!</p>
    </>
  );
}
```

> 在 `next/image` 可瞭解更多關於 [`調整圖片尺寸需求`](#image-sizing)。

### 網域(Domains)

若您想使用 Next.js 內建的圖片優化載入 API 來取得遠端圖片檔，則須保持 `loader` 預設的設定，並於圖片的 `src` 屬性中輸入其 URL 絕對路徑。

為了避免您的應用程式遭受惡意使用者攻擊，您應列出您預計於 `next/image` 元件中會使用的遠端 `主機名稱(hostname)` 清單。

> 可瞭解更多關於 [`網域(domains)`](/docs/api-reference/next/image.md#domains) 設定檔

### Loaders

您或許有注意到，在 [先前的範例](#remote-images) 中，取得遠端圖片時，使用得是不完整的 URL (`"/me.png"`)。之所以可以這樣寫，是因為 `next/image` 內有設計 [loader](/docs/api-reference/next/image.md#loader) 機制。

Loader 是個可以為您的圖片檔生成許多對應 URL 的功能，他會將根網域(root domain)加至您所提供的 `src` 中，並生成對應不同圖片尺寸大小的 URL。這些 URL 將在自動產生 [srcset](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/srcset) 的過程中使用到，使您的網頁使用者可以看到對應其可視範圍正確的圖片尺寸。

Next.js 中的預設 loader 使用內建的圖片優化 API，它可以優化所有在網路中的各種圖片載入，並可直接取用於 Next.js 的網頁伺服器。若您需要從您的 CDN 或圖片伺服器取用檔案，則您可選用合適的 [built-in loaders](/docs/api-reference/next/image.md#built-in-loaders) 或自己寫所需的 loader。

Loaders 可於每張圖片個別設定，也可在應用程式中統一設定。

### 優先權

您可以將 `優先權(priority)` 屬性加入您頁面中，屬於 [最大內容繪製 (LCP) 元素](https://web.dev/lcp/#what-elements-are-considered) 的圖片。如此一來， Next.js 將優先處理此圖片的載入 (例如：透過預載入標籤或優先排序提示)，使您的 LCP 指標分數可顯著提升。

最大內容繪製 (LCP) 元素，通常為該頁面可視區域中，最大的圖片或文字區塊。若您未在 LCP 元素中設定 `priority` 屬性，則在跑 `next dev` 指令時，您將會於 console 中看到相關警告。

若您已辨認出該頁面的 LCP 圖片，您可參考如下範例，新增 `priority` 屬性：

```jsx
import Image from 'next/image';

export default function Home() {
  return (
    <>
      <h1>My Homepage</h1>
      <Image
        src="/me.png"
        alt="Picture of the author"
        width={500}
        height={500}
        priority
      />
      <p>Welcome to my homepage!</p>
    </>
  );
}
```

在 [`next/image` 元件文件](/docs/api-reference/next/image.md#priority) 可瞭解更多關於 `priority` 屬性

## Image Sizing

One of the ways that images most commonly hurt performance is through _layout shift_, where the image pushes other elements around on the page as it loads in. This performance problem is so annoying to users that it has its own Core Web Vital, called [Cumulative Layout Shift](https://web.dev/cls/). The way to avoid image-based layout shifts is to [always size your images](https://web.dev/optimize-cls/#images-without-dimensions). This allows the browser to reserve precisely enough space for the image before it loads.

Because `next/image` is designed to guarantee good performance results, it cannot be used in a way that will contribute to layout shift, and **must** be sized in one of three ways:

1. Automatically, using a [static import](#local-images)
2. Explicitly, by including a [`width`](/docs/api-reference/next/image.md#width) and [`height`](/docs/api-reference/next/image.md#height) property
3. Implicitly, by using [`layout="fill"`](/docs/api-reference/next/image.md#layout) which causes the image to expand to fill its parent element.

> ### What if I don't know the size of my images?
>
> If you are accessing images from a source without knowledge of the images' sizes, there are several things you can do:
>
> **Use `layout='fill'`**
>
> The `fill` layout mode allows your image to be sized by its parent element. Consider using CSS to give the image's parent element space on the page, then using the [`objectFit property`](/docs/api-reference/next/image.md#objectfit) with `fill`, `contain`, or `cover`, along with the [`objectPosition property`](/docs/api-reference/next/image.md#objectposition) to define how the image should occupy that space.
>
> **Normalize your images**
>
> If you're serving images from a source that you control, consider modifying your image pipeline to normalize the images to a specific size.
>
> **Modify your API calls**
>
> If your application is retrieving image URLs using an API call (such as to a CMS), you may be able to modify the API call to return the image dimensions along with the URL.

If none of the suggested methods works for sizing your images, the `next/image` component is designed to work well on a page alongside standard `<img>` elements.

## Styling

> Note: Many of the styling issues listed below can be solved with [`next/future/image`](/docs/api-reference/next/future/image.md)

Styling the Image component is not that different from styling a normal `<img>` element, but there are a few guidelines to keep in mind:

**Pick the correct layout mode**

The image component has several different [layout modes](/docs/api-reference/next/image.md#layout) that define how it is sized on the page. If the styling of your image isn't turning out the way you want, consider experimenting with other layout modes.

**Target the image with className, not based on DOM structure**

For most layout modes, the Image component will have a DOM structure of one `<img>` tag wrapped by exactly one `<span>`. For some modes, it may also have a sibling `<span>` for spacing. These additional `<span>` elements are critical to allow the component to prevent layout shifts.

The recommended way to style the inner `<img>` is to set the `className` prop on the Image component to the value of an imported [CSS Module](/docs/basic-features/built-in-css-support.md#adding-component-level-css). The value of `className` will be automatically applied to the underlying `<img>` element.

Alternatively, you can import a [global stylesheet](/docs/basic-features/built-in-css-support#adding-a-global-stylesheet) and manually set the `className` prop to the same name used in the global stylesheet.

You cannot use [styled-jsx](/docs/basic-features/built-in-css-support.md#css-in-js) because it's scoped to the current component.

**When using `layout='fill'`, the parent element must have `position: relative`**

This is necessary for the proper rendering of the image element in that layout mode.

**When using `layout='responsive'`, the parent element must have `display: block`**

This is the default for `<div>` elements but should be specified otherwise.

## Properties

[**View all properties available to the `next/image` component.**](/docs/api-reference/next/image.md)

### Styling Examples

For examples of the Image component used with the various fill modes, see the [Image component example app](https://image-component.nextjs.gallery/).

## Configuration

The `next/image` component and Next.js Image Optimization API can be configured in the [`next.config.js` file](/docs/api-reference/next.config.js/introduction.md). These configurations allow you to [enable remote images](/docs/api-reference/next/image.md#domains), [define custom image breakpoints](/docs/api-reference/next/image.md#device-sizes), [change caching behavior](/docs/api-reference/next/image.md#caching-behavior) and more.

[**Read the full image configuration documentation for more information.**](/docs/api-reference/next/image.md#configuration-options)

## Related

For more information on what to do next, we recommend the following sections:

<div className="card">
  <a href="/docs/api-reference/next/image.md">
    <b>next/image</b>
    <small>See all available properties for the Image component</small>
  </a>
</div>

